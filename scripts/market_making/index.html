
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../logger/handlers/">
      
      
        <link rel="next" href="../tick_archival/">
      
      
      <link rel="icon" href="../../icons/logo.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>Market Maker - quantpylib</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#live-simulation-modes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="quantpylib" class="md-header__button md-logo" aria-label="quantpylib" data-md-component="logo">
      
  <img src="../../icons/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            quantpylib
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Market Maker
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../simulator/simulator/" class="md-tabs__link">
          
  
  User Documentation

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="quantpylib" class="md-nav__button md-logo" aria-label="quantpylib" data-md-component="logo">
      
  <img src="../../icons/logo.png" alt="logo">

    </a>
    quantpylib
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            quantpylib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib.simulator
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.simulator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/simulator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.simulator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/alpha/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.simulator.alpha
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/gene/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.simulator.gene
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.simulator.models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/operators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.simulator.operators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/performance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.simulator.performance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib.hft
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.hft
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/hft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.hft
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/feed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.hft.feed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/oms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.hft.oms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/mocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.hft.mocks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/lob/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.hft.lob
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/trades/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.hft.trades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.hft.features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/stats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.hft.stats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.hft.utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib.throttler
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.throttler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../throttler/throttler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.throttler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../throttler/aiohttp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.throttler.aiohttp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../throttler/aiosonic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.throttler.aiosonic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../throttler/httpx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.throttler.httpx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../throttler/rate_semaphore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.throttler.rate_semaphore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../throttler/decorators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.throttler.decorators
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4" >
        
          
          <label class="md-nav__link" for="__nav_2_1_4" id="__nav_2_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib.utilities
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/utilities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.utilities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/general/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.utilities.general
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/math/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.utilities.math
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5" id="__nav_2_1_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib.datapoller
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.datapoller
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/datapoller/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.datapoller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/master/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.datapoller.master
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.datapoller.utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.datapoller.base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/crypto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.datapoller.crypto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/currencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.datapoller.currencies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/equities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.datapoller.equities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/exchange/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.datapoller.exchange
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.datapoller.metadata
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_6" >
        
          
          <label class="md-nav__link" for="__nav_2_1_6" id="__nav_2_1_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib.gateway
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_6">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.gateway
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.gateway
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/account/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.gateway.account
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.gateway.base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/exchange/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.gateway.exchange
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/executor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.gateway.executor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/master/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.gateway.master
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/orders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.gateway.orders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/positions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.gateway.positions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.gateway.utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_7" >
        
          
          <label class="md-nav__link" for="__nav_2_1_7" id="__nav_2_1_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib.standards
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_7">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.standards
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/standards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.standards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/intervals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.standards.intervals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/markets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.standards.markets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/portfolio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.standards.portfolio
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_8" >
        
          
          <label class="md-nav__link" for="__nav_2_1_8" id="__nav_2_1_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib.wrappers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_8">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.wrappers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/wrappers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/binance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers.binance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/bybit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers.bybit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/hyperliquid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers.hyperliquid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/paradex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers.paradex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/woox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers.woox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/polymarket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers.polymarket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/eodhd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers.eodhd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/oanda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers.oanda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/yfinance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.wrappers.yfinance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_9" >
        
          
          <label class="md-nav__link" for="__nav_2_1_9" id="__nav_2_1_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    quantpylib.logger
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_9">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.logger
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logger/logger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.logger
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logger/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.logger.utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logger/formatters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.logger.formatters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logger/handlers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    quantpylib.logger.handlers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Market Maker
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Market Maker
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#live-simulation-modes" class="md-nav__link">
    <span class="md-ellipsis">
      Live + Simulation Modes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation-report-ors" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation Report (ORS)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#open-research-standard" class="md-nav__link">
    <span class="md-ellipsis">
      Open Research Standard
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling" class="md-nav__link">
    <span class="md-ellipsis">
      Modelling
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tick_archival/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tick Archival
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trend_following/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trend Follower
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Market Maker</h1>

<p>This tutorial shows how to do market making (backtests and live) on different exchanges using <code>quantpylib</code>'s gateway connectors, data feeds and order management system.</p>
<p>The sample scripts are placed inside <code>./scripts</code> folder in the <code>quantpylib</code> repo. This example works with exchanges implementing the <code>quantpylib.gateway.master.Gateway</code> endpoints, such as <code>binance</code>, <code>hyperliquid</code>, <code>bybit</code> <code>paradex</code> and <code>woox</code>.</p>
<p>Let us first consider the data and portfolio states required for a market-making operation. Typically, a market-maker needs to be able to track their portfolio states: order states (pending/open/cancelled/rejected), open positions, account equity/balance and so on.</p>
<p>Of course, tick data feeds are also required. This tick data feed includes but are not limited to orderbook ticks of the market we intend to quote, trade ticks of said market, as well as correlated assets - leader assets (<code>AAPL</code>,<code>BTC</code>) and so on.</p>
<p>In general, a market maker action triggers include but are not limited to internal clock cycles, trade arrival, orderbook delta updates and a number of variable proprietary logic. We may choose to act on these data immediately upon arrival (a on-tick behavior) or store it in some shared state that is later used to compute optimal market quotes. We will explore all of these options. </p>
<h2 id="live-simulation-modes">Live + Simulation Modes</h2>
<p>Our message replay architecture allows us to both trade and backtest high-frequency data using a unified codebase for seamless transition from research to production environments.</p>
<p>Let's begin with the following imports - we are going demonstrate using a reference feed for <code>binance/SOLUSDT</code> and quoting on <code>bybit/SOLUSDT</code>. Let us use the following imports.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">os</span> 
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span> <span class="nn">pytz</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span> <span class="nn">asyncio</span> 
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">logging</span> 
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">import</span> <span class="nn">argparse</span> 
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> 
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">load_dotenv</span><span class="p">()</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="kn">import</span> <span class="nn">quantpylib.utilities.math</span> <span class="k">as</span> <span class="nn">math</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="kn">import</span> <span class="nn">quantpylib.standards.markets</span> <span class="k">as</span> <span class="nn">markets</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="kn">from</span> <span class="nn">quantpylib.hft.oms</span> <span class="kn">import</span> <span class="n">OMS</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="kn">from</span> <span class="nn">quantpylib.hft.feed</span> <span class="kn">import</span> <span class="n">Feed</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="kn">from</span> <span class="nn">quantpylib.gateway.master</span> <span class="kn">import</span> <span class="n">Gateway</span> 
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="kn">from</span> <span class="nn">quantpylib.utilities.general</span> <span class="kn">import</span> <span class="n">_time</span><span class="p">,</span><span class="n">pdf_snapshot</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Parse script mode.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Set script mode.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="n">simulated</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">True</span>
</code></pre></div>
If we run <code>python3 script.py 0</code> we will run it in simulation (backtest) mode, otherwise we will trade in a live market for <code>python3 script.py 1</code>.</p>
<p>For <code>binance</code>, we are only using the public data feeds, while we need to perform privileged activity on <code>bybit</code>. So we will need keys for bybit:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">config_keys</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="s2">&quot;binance&quot;</span><span class="p">:{},</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="s2">&quot;bybit&quot;</span><span class="p">:{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>        <span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;BYBIT_DEMO_KEY&#39;</span><span class="p">,</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>        <span class="s1">&#39;secret&#39;</span><span class="p">:</span><span class="s1">&#39;BYBIT_DEMO_SECRET&#39;</span><span class="p">,</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>        <span class="s1">&#39;env&#39;</span><span class="p">:</span><span class="s1">&#39;demo&#39;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="p">},</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="p">}</span>
</code></pre></div>
These are our setup and configs:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">exc</span> <span class="o">=</span> <span class="s1">&#39;bybit&#39;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">tickers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SOLUSDT&quot;</span><span class="p">]</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">stream_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="s2">&quot;binance&quot;</span><span class="p">:[</span><span class="s2">&quot;BTCUSDT&quot;</span><span class="p">,</span><span class="s2">&quot;SOLUSDT&quot;</span><span class="p">],</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="s2">&quot;bybit&quot;</span><span class="p">:[</span><span class="s2">&quot;SOLUSDT&quot;</span><span class="p">],</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="p">}</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="n">reference</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="s1">&#39;SOLUSDT&#39;</span><span class="p">:(</span><span class="s1">&#39;binance&#39;</span><span class="p">,</span><span class="s1">&#39;SOLUSDT&#39;</span><span class="p">),</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="p">}</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="n">run</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="n">replayer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="n">print_interval</span> <span class="o">=</span> <span class="mi">120</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1">#every 2 mins</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="k">if</span> <span class="n">simulated</span><span class="p">:</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    <span class="kn">from</span> <span class="nn">quantpylib.hft.mocks</span> <span class="kn">import</span> <span class="n">Replayer</span><span class="p">,</span><span class="n">Latencies</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="n">start</span><span class="o">=</span><span class="s1">&#39;2025-01-10:01&#39;</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2025-01-10:02&#39;</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="n">latencies</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">REQ_PUBLIC</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">REQ_PRIVATE</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">ACK_PUBLIC</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">ACK_PRIVATE</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">FEED_PUBLIC</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">FEED_PRIVATE</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>    <span class="p">}</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>    <span class="n">replayer_configs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>        <span class="s2">&quot;maker_fees&quot;</span><span class="p">:</span><span class="mf">0.000</span><span class="p">,</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>        <span class="s2">&quot;taker_fees&quot;</span><span class="p">:</span><span class="mf">0.000</span><span class="p">,</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>        <span class="s2">&quot;latencies&quot;</span><span class="p">:</span><span class="n">latencies</span><span class="p">,</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    <span class="p">}</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>    <span class="n">run</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1e9</span><span class="p">)</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>    <span class="n">time</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">_time</span><span class="p">()</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">(</span><span class="n">config_keys</span><span class="o">=</span><span class="n">config_keys</span><span class="p">)</span>
</code></pre></div>
We demonstrate with null latencies and fees in our simulation mode. You can also specify in <code>milliseconds</code> the latency for the different message channels, as well as fee tiers for reality modelling. </p>
<p>We will kick off the script like this:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="k">await</span> <span class="n">gateway</span><span class="o">.</span><span class="n">init_clients</span><span class="p">()</span> 
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="k">if</span> <span class="n">simulated</span><span class="p">:</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        <span class="n">oms</span><span class="p">,</span><span class="n">feed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">sim_prepare</span><span class="p">()</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="n">oms</span> <span class="o">=</span> <span class="n">OMS</span><span class="p">(</span><span class="n">gateway</span><span class="o">=</span><span class="n">gateway</span><span class="p">,</span><span class="n">exchanges</span><span class="o">=</span><span class="p">[</span><span class="n">exc</span><span class="p">],</span><span class="n">refresh_orders_snapshot</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">refresh_positions_snapshot</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        <span class="n">feed</span> <span class="o">=</span> <span class="n">Feed</span><span class="p">(</span><span class="n">gateway</span><span class="o">=</span><span class="n">gateway</span><span class="p">)</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="k">await</span> <span class="n">oms</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="k">await</span> <span class="n">hft</span><span class="p">(</span><span class="n">replayer</span><span class="p">,</span><span class="n">oms</span><span class="p">,</span><span class="n">feed</span><span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="k">await</span> <span class="n">gateway</span><span class="o">.</span><span class="n">cleanup_clients</span><span class="p">()</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div></p>
<p>The <a href="../../gateway/gateway"><code>gateway</code></a> is the connector to the relevant exchanges - which is passed into the <a href="../../hft/oms"><code>oms</code></a> and <a href="../../hft/feed"><code>feed</code></a> objects. The <code>oms</code> handles order/position tracking, recovery, execution and auxiliary tasks. The <code>feed</code> does tick data subscription, storing, and retrieval. In simulation environments, we would first need to load data from archives into RAM. The code showing data load and formats are explained in detail in our post on <a href="../tick_archival">obtaining, archiving, and restoring data</a>.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">sim_prepare</span><span class="p">():</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="n">l2_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">exchange</span><span class="p">:{}</span> <span class="k">for</span> <span class="n">exchange</span> <span class="ow">in</span> <span class="n">stream_data</span><span class="p">}</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="n">trade_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">exchange</span><span class="p">:{}</span> <span class="k">for</span> <span class="n">exchange</span> <span class="ow">in</span> <span class="n">stream_data</span><span class="p">}</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="k">for</span> <span class="n">exchange</span><span class="p">,</span><span class="n">tickers</span> <span class="ow">in</span> <span class="n">stream_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>        <span class="c1"># await asyncio.gather(*[</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>        <span class="c1">#     restore_archives(</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>        <span class="c1">#         exc=exchange,</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>        <span class="c1">#         ticker=ticker,</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>        <span class="c1">#         depth=20,</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="c1">#         start=start,</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="c1">#         end=end,</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>        <span class="c1">#     ) for ticker in tickers</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>        <span class="c1"># ])</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>        <span class="n">lob_archives</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>            <span class="n">Feed</span><span class="o">.</span><span class="n">load_lob_archives</span><span class="p">(</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>                <span class="n">exc</span><span class="o">=</span><span class="n">exchange</span><span class="p">,</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>                <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>                <span class="n">depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>                <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>                <span class="n">end</span><span class="o">=</span><span class="n">end</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>            <span class="p">)</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>        <span class="p">]</span> 
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>        <span class="n">trade_archives</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>            <span class="n">Feed</span><span class="o">.</span><span class="n">load_trade_archives</span><span class="p">(</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>                <span class="n">exc</span><span class="o">=</span><span class="n">exchange</span><span class="p">,</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>                <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>                <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>                <span class="n">end</span><span class="o">=</span><span class="n">end</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>            <span class="p">)</span> <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>        <span class="p">]</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>        <span class="n">l2_data</span><span class="p">[</span><span class="n">exchange</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ticker</span><span class="p">:</span><span class="n">lob_archive</span> <span class="k">for</span> <span class="n">ticker</span><span class="p">,</span><span class="n">lob_archive</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tickers</span><span class="p">,</span><span class="n">lob_archives</span><span class="p">)}</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>        <span class="n">trade_data</span><span class="p">[</span><span class="n">exchange</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">ticker</span><span class="p">:</span><span class="n">trade_archive</span> <span class="k">for</span> <span class="n">ticker</span><span class="p">,</span><span class="n">trade_archive</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tickers</span><span class="p">,</span><span class="n">trade_archives</span><span class="p">)}</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>    <span class="k">global</span> <span class="n">replayer</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">time</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>    <span class="n">replayer</span> <span class="o">=</span> <span class="n">Replayer</span><span class="p">(</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>        <span class="n">l2_data</span><span class="o">=</span><span class="n">l2_data</span><span class="p">,</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>        <span class="n">trade_data</span><span class="o">=</span><span class="n">trade_data</span><span class="p">,</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>        <span class="n">gateway</span><span class="o">=</span><span class="n">gateway</span><span class="p">,</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>        <span class="o">**</span><span class="n">replayer_configs</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>    <span class="p">)</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>    <span class="n">oms</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">get_oms</span><span class="p">()</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>    <span class="n">feed</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">get_feed</span><span class="p">()</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>    <span class="n">run</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">replayer</span><span class="o">.</span><span class="n">play</span><span class="p">()</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>    <span class="n">time</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">replayer</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>    <span class="k">return</span> <span class="n">oms</span><span class="p">,</span> <span class="n">feed</span>
</code></pre></div>
In the code above - the <a href="../../hft/mocks"><code>quantpylib.hft.mocks</code></a> module <code>MockOMS</code> and <code>MockFeed</code> are used in place of the <code>OMS</code> and <code>Feed</code> objects during simulation. These can be obtained from the <code>Replayer</code> object. Instead of the system time - the replayer time is used for simulations.</p>
<p>We can subscribe to leader tick data feeds, such as BTC trade feeds. For instance, we can use this to compute lead-lag correlations between the quote market and leader market for trade signal. We show how to perform the subscription - but we will not use this in our demonstration. Here the <code>replayer</code> is <code>None</code> in live trading and <code>quantpylib.hft.mocks.Replayer</code> in backtest: 
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">hft</span><span class="p">(</span><span class="n">replayer</span><span class="p">,</span><span class="n">oms</span><span class="p">,</span><span class="n">feed</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="c1">#&gt;&gt; subscribe to global tick-data (if any)</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="n">btc_feed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">feed</span><span class="o">.</span><span class="n">add_trades_feed</span><span class="p">(</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="n">exc</span><span class="o">=</span><span class="s1">&#39;binance&#39;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        <span class="n">ticker</span><span class="o">=</span><span class="s1">&#39;BTCUSDT&#39;</span><span class="p">,</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>        <span class="n">buffer</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="p">)</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>        <span class="n">quote_markets</span><span class="p">(</span><span class="n">replayer</span><span class="o">=</span><span class="n">replayer</span><span class="p">,</span><span class="n">oms</span><span class="o">=</span><span class="n">oms</span><span class="p">,</span><span class="n">feed</span><span class="o">=</span><span class="n">feed</span><span class="p">,</span><span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">)</span> 
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>        <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    <span class="p">])</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span class="k">await</span> <span class="n">run</span><span class="p">()</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="k">if</span> <span class="n">simulated</span><span class="p">:</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>        <span class="k">await</span> <span class="n">sim_report</span><span class="p">(</span><span class="n">replayer</span><span class="p">)</span>
</code></pre></div>
Let's implement <code>quote_markets</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">trade_handler</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="k">pass</span> <span class="c1">#msg : (ts,price,size,dir)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">book_handler</span><span class="p">(</span><span class="n">lob</span><span class="p">):</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="k">pass</span> <span class="c1">#lob : quantpylib.hft.lob.LOB</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">quote_markets</span><span class="p">(</span><span class="n">replayer</span><span class="p">,</span><span class="n">oms</span><span class="p">,</span><span class="n">feed</span><span class="p">,</span><span class="n">ticker</span><span class="p">):</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="n">live_orders</span> <span class="o">=</span> <span class="n">oms</span><span class="o">.</span><span class="n">orders_peek</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="n">live_positions</span> <span class="o">=</span> <span class="n">oms</span><span class="o">.</span><span class="n">positions_peek</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">)</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="n">ref_exc</span><span class="p">,</span><span class="n">ref_ticker</span> <span class="o">=</span> <span class="n">reference</span><span class="p">[</span><span class="n">ticker</span><span class="p">]</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    <span class="n">reference_trade_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">feed</span><span class="o">.</span><span class="n">add_trades_feed</span><span class="p">(</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>        <span class="n">exc</span><span class="o">=</span><span class="n">ref_exc</span><span class="p">,</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>        <span class="n">ticker</span><span class="o">=</span><span class="n">ref_ticker</span><span class="p">,</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>        <span class="n">buffer</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>        <span class="c1"># handler=trade_handler</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    <span class="p">)</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>    <span class="n">reference_trades</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">get_feed</span><span class="p">(</span><span class="n">reference_trade_id</span><span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>    <span class="n">reference_l2_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">feed</span><span class="o">.</span><span class="n">add_l2_book_feed</span><span class="p">(</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>        <span class="n">exc</span><span class="o">=</span><span class="n">ref_exc</span><span class="p">,</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>        <span class="n">ticker</span><span class="o">=</span><span class="n">ref_ticker</span><span class="p">,</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>        <span class="n">depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>        <span class="n">buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>        <span class="c1"># handler=book_handler</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>    <span class="p">)</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>    <span class="n">reference_lob</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">get_feed</span><span class="p">(</span><span class="n">reference_l2_id</span><span class="p">)</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>    <span class="n">ticker_trade_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">feed</span><span class="o">.</span><span class="n">add_trades_feed</span><span class="p">(</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>        <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>        <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>        <span class="n">buffer</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    <span class="p">)</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>    <span class="n">ticker_trades</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">get_feed</span><span class="p">(</span><span class="n">ticker_trade_id</span><span class="p">)</span>
</code></pre></div>
The <code>oms</code> does order tracking and maintains <code>live_orders</code> which is a <a href="../../standards/portfolio"><code>quantpylib.standards.portfolio.Orders</code></a> object. Similarly, the <code>oms</code> maintains <code>live_positions</code> which is a <a href="../../standards/portfolio"><code>quantpylib.standards.portfolio.Positions</code></a> object. 
These are achieved via the <code>gateway</code>'s underlying socket connections and requests. Note that the <code>oms</code> itself is a separate functionality provided by <code>quantpylib</code>, and is able to do a variety of useful things - such as registering coroutine handlers for order updates, position fills and so on - see examples <a href="../../hft/hft/#oms">here</a>. In this section, we will not register any order/position update handlers, and just rely on the live updation of our orders which is intitated by default on <code>oms.init()</code>.</p>
<p>Also, we subscribe to the reference market tick data feeds. We can register handlers for a 'on-tick' behavior - the trades receive <code>ts,price,size,dir</code> in the handler and orderbook updates receive <code>quantpylib.hft.lob.LOB</code> object. We are not going to have triggers for orders (you can, if you want) on the reference market tick events. Instead, we are going to use the live data buffers <code>reference_trades</code> (a <a href="../../hft/trades"><code>quantpylib.hft.trades.Trades</code></a>) object and <code>reference_lob</code> (a <a href="../../hft/lob"><code>quantpylib.hft.lob.LOB</code></a>) object. These live data buffer classes have in-built methods to compute useful statistics such as <code>get_imbalance</code>, <code>get_vol</code>, <code>get_mid</code> and so on. In our demonstration, we choose action triggers to follow the on tick behaviour of orderbook events on the quote market.</p>
<p>Say, we would like to submit/cancel orders using the following logic (there is no alpha in this quoter):</p>
<div class="highlight"><pre><span></span><code>1. Fix order notional value at 200.
2. Compute volume adjusted mid price (VAMP) with notional value of the sum of last 15 taker trades. The VAMP is computed on the orderbook of the reference market, not quote market.
3. Control inventory by quoting around VAMP with baseline spread of 6 bps, and between 2bps and 6bps depending on holding inventory. Also, be strictly less aggressive than BBA on quote exchange.
4. If the bid and ask level does not exist, submit new orders. If other price level orders exist, cancel.
</code></pre></div>
<p>We make no comment or assertions on the viability of said 'rules'. For specifics on how to pass the parameters to <code>oms</code> methods, refer to <a href="../../hft/oms">documentation</a> and <a href="../../hft/hft">examples</a>. <a href="../../gateway/gateway">gateway documentation and examples</a> should be helpful. Let's continue with the <code>quote_markets</code> implementation:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">quote_markets</span><span class="p">(</span><span class="n">replayer</span><span class="p">,</span><span class="n">oms</span><span class="p">,</span><span class="n">feed</span><span class="p">,</span><span class="n">ticker</span><span class="p">):</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="c1">#...</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">ticker_trades</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">get_feed</span><span class="p">(</span><span class="n">ticker_trade_id</span><span class="p">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="c1">#...code above</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="n">order_value</span> <span class="o">=</span> <span class="mi">200</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">last_print</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">l2_handler</span><span class="p">(</span><span class="n">lob</span><span class="p">):</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        <span class="k">nonlocal</span> <span class="n">last_print</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        <span class="n">stamp</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>        <span class="n">stamp</span> <span class="o">=</span> <span class="n">stamp</span> <span class="o">-</span> <span class="p">(</span><span class="n">stamp</span> <span class="o">%</span> <span class="n">print_interval</span><span class="p">)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>        <span class="k">if</span> <span class="n">stamp</span> <span class="o">!=</span> <span class="n">last_print</span><span class="p">:</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="n">tz</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>            <span class="n">last_print</span> <span class="o">=</span> <span class="n">stamp</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>        <span class="n">pos_amount</span> <span class="o">=</span> <span class="n">live_positions</span><span class="o">.</span><span class="n">get_ticker_amount</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">)</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>        <span class="n">inventory_notional</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos_amount</span><span class="p">)</span> <span class="o">*</span> <span class="n">lob</span><span class="o">.</span><span class="n">get_mid</span><span class="p">()</span> 
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>        <span class="n">q</span> <span class="o">=</span> <span class="n">inventory_notional</span> <span class="o">/</span> <span class="n">order_value</span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>        <span class="n">order_bids</span> <span class="o">=</span> <span class="n">live_orders</span><span class="o">.</span><span class="n">get_bid_orders</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">)</span> 
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>        <span class="n">order_asks</span> <span class="o">=</span> <span class="n">live_orders</span><span class="o">.</span><span class="n">get_ask_orders</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">)</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>        <span class="n">tds</span> <span class="o">=</span> <span class="n">reference_trades</span><span class="o">.</span><span class="n">get_sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>        <span class="n">notional</span> <span class="o">=</span> <span class="mi">20000</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tds</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">tds</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>        <span class="n">ref_vamp</span> <span class="o">=</span> <span class="n">reference_lob</span><span class="o">.</span><span class="n">get_vamp</span><span class="p">(</span><span class="n">notional</span><span class="p">)</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ref_vamp</span><span class="p">):</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>            <span class="k">return</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>        <span class="n">bid</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>            <span class="n">ref_vamp</span> <span class="o">-</span> <span class="p">((</span><span class="mi">6</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-4</span><span class="p">)</span> <span class="o">*</span> <span class="n">ref_vamp</span><span class="p">,</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>            <span class="n">lob</span><span class="o">.</span><span class="n">get_bids</span><span class="p">()[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>        <span class="p">)</span>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>        <span class="n">ask</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>            <span class="n">ref_vamp</span> <span class="o">+</span> <span class="p">((</span><span class="mi">6</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-4</span><span class="p">)</span> <span class="o">*</span> <span class="n">ref_vamp</span><span class="p">,</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>            <span class="n">lob</span><span class="o">.</span><span class="n">get_asks</span><span class="p">()[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>        <span class="p">)</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>        <span class="n">bid_price</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">oms</span><span class="o">.</span><span class="n">rounded_price</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span><span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span><span class="n">price</span><span class="o">=</span><span class="n">bid</span><span class="p">)))</span>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>        <span class="n">ask_price</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">oms</span><span class="o">.</span><span class="n">rounded_price</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span><span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span><span class="n">price</span><span class="o">=</span><span class="n">ask</span><span class="p">)))</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>        <span class="n">orders</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">bid</span><span class="o">.</span><span class="n">price</span> <span class="o">==</span> <span class="n">bid_price</span> <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">order_bids</span><span class="p">):</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>            <span class="n">orders</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a>                <span class="s2">&quot;exc&quot;</span><span class="p">:</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>                <span class="s2">&quot;ticker&quot;</span><span class="p">:</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a>                <span class="s2">&quot;amount&quot;</span><span class="p">:</span><span class="n">order_value</span><span class="o">/</span><span class="n">lob</span><span class="o">.</span><span class="n">get_mid</span><span class="p">(),</span>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a>                <span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="n">bid_price</span><span class="p">,</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a>                <span class="s2">&quot;round_to_specs&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a>            <span class="p">})</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">ask</span><span class="o">.</span><span class="n">price</span> <span class="o">==</span> <span class="n">ask_price</span> <span class="k">for</span> <span class="n">ask</span> <span class="ow">in</span> <span class="n">order_asks</span><span class="p">):</span>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a>            <span class="n">orders</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>                <span class="s2">&quot;exc&quot;</span><span class="p">:</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>                <span class="s2">&quot;ticker&quot;</span><span class="p">:</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a>                <span class="s2">&quot;amount&quot;</span><span class="p">:</span><span class="n">order_value</span><span class="o">/</span><span class="n">lob</span><span class="o">.</span><span class="n">get_mid</span><span class="p">()</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a>                <span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="n">ask_price</span><span class="p">,</span>
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a>                <span class="s2">&quot;round_to_specs&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a>            <span class="p">})</span>
<a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a>
<a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a>        <span class="n">cancels</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a>        <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">order_bids</span><span class="p">:</span>
<a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a>            <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">price</span> <span class="o">!=</span> <span class="n">bid_price</span><span class="p">:</span>
<a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a>                <span class="n">cancels</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a>                    <span class="s2">&quot;exc&quot;</span><span class="p">:</span><span class="n">order</span><span class="o">.</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a>                    <span class="s2">&quot;ticker&quot;</span><span class="p">:</span><span class="n">order</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a>                    <span class="s2">&quot;cloid&quot;</span><span class="p">:</span><span class="n">order</span><span class="o">.</span><span class="n">cloid</span>
<a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a>                <span class="p">})</span>
<a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a>        <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">order_asks</span><span class="p">:</span>
<a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a>            <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">price</span> <span class="o">!=</span> <span class="n">ask_price</span><span class="p">:</span>
<a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a>                <span class="n">cancels</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a>                    <span class="s2">&quot;exc&quot;</span><span class="p">:</span><span class="n">order</span><span class="o">.</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a>                    <span class="s2">&quot;ticker&quot;</span><span class="p">:</span><span class="n">order</span><span class="o">.</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a>                    <span class="s2">&quot;cloid&quot;</span><span class="p">:</span><span class="n">order</span><span class="o">.</span><span class="n">cloid</span>
<a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a>                <span class="p">})</span>
<a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a>        <span class="k">if</span> <span class="n">orders</span><span class="p">:</span>
<a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
<a id="__codelineno-7-77" name="__codelineno-7-77" href="#__codelineno-7-77"></a>                    <span class="n">oms</span><span class="o">.</span><span class="n">limit_order</span><span class="p">(</span><span class="o">**</span><span class="n">order</span><span class="p">)</span> <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">orders</span>
<a id="__codelineno-7-78" name="__codelineno-7-78" href="#__codelineno-7-78"></a>                <span class="p">])</span>
<a id="__codelineno-7-79" name="__codelineno-7-79" href="#__codelineno-7-79"></a>            <span class="k">except</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-7-80" name="__codelineno-7-80" href="#__codelineno-7-80"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-7-81" name="__codelineno-7-81" href="#__codelineno-7-81"></a>        <span class="k">if</span> <span class="n">cancels</span><span class="p">:</span>
<a id="__codelineno-7-82" name="__codelineno-7-82" href="#__codelineno-7-82"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-7-83" name="__codelineno-7-83" href="#__codelineno-7-83"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
<a id="__codelineno-7-84" name="__codelineno-7-84" href="#__codelineno-7-84"></a>                    <span class="n">oms</span><span class="o">.</span><span class="n">cancel_order</span><span class="p">(</span><span class="o">**</span><span class="n">cancel</span><span class="p">)</span> <span class="k">for</span> <span class="n">cancel</span> <span class="ow">in</span> <span class="n">cancels</span>
<a id="__codelineno-7-85" name="__codelineno-7-85" href="#__codelineno-7-85"></a>                <span class="p">])</span>
<a id="__codelineno-7-86" name="__codelineno-7-86" href="#__codelineno-7-86"></a>            <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-7-87" name="__codelineno-7-87" href="#__codelineno-7-87"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-7-88" name="__codelineno-7-88" href="#__codelineno-7-88"></a>
<a id="__codelineno-7-89" name="__codelineno-7-89" href="#__codelineno-7-89"></a>    <span class="n">l2_feed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">feed</span><span class="o">.</span><span class="n">add_l2_book_feed</span><span class="p">(</span>
<a id="__codelineno-7-90" name="__codelineno-7-90" href="#__codelineno-7-90"></a>        <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-7-91" name="__codelineno-7-91" href="#__codelineno-7-91"></a>        <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-7-92" name="__codelineno-7-92" href="#__codelineno-7-92"></a>        <span class="n">depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-7-93" name="__codelineno-7-93" href="#__codelineno-7-93"></a>        <span class="n">buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-7-94" name="__codelineno-7-94" href="#__codelineno-7-94"></a>        <span class="n">handler</span><span class="o">=</span><span class="n">l2_handler</span>
<a id="__codelineno-7-95" name="__codelineno-7-95" href="#__codelineno-7-95"></a>    <span class="p">)</span>
</code></pre></div>
This quote market orderbook feed is subscribed to with the on-tick behaviour of <code>l2_handler</code>. The specified rules are then implemented. On the web-platform of selected exchange (bybit) we can see the quotes submitted (if live):</p>
<p><img alt="alt text" src="../../archives/quotes_bybit.jpg" /></p>
<h2 id="simulation-report-ors">Simulation Report (ORS)</h2>
<p>If we were in simulation mode, the <code>Replayer</code> object contains very useful metrics and plots for the simulation events. We will demonstrate these - recall that in the <code>hft</code> method in the above <a href="#live--simulation-modes">section</a> - we called the <code>sim_report</code> method.</p>
<p>We will also demonstrate a new proposal, the Open Research Standard (ORS), <code>quantpylib</code>'s push towards replicable, shareable and effortless quantitative research with code. Quantitative research and papers are often extremely challenging to replicate either in part of the academic tendency for citation mining (lying with statistics) or variability in data, assumptions and implementation. The ORS promotes reliable research with the automatic logging of code results, parameters and implementation together with the <code>pdf_snapshot</code> method for report generation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">sim_report</span><span class="p">(</span><span class="n">replayer</span><span class="p">):</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;./logs/reports&#39;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">exchange_plot</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/exchange.png&#39;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="n">markouts_plot</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/markouts.png&#39;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="n">prices_plot</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{folder}</span><span class="s1">/prices_</span><span class="si">{ticker}</span><span class="s1">.png&#39;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">counterparty_plot</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/counterparty_pnl.png&#39;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="n">fairprices_plot</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/fairprices.png&#39;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    <span class="c1">#see plots and reports</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="n">report_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>        <span class="s1">&#39;configs&#39;</span><span class="p">,</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>        <span class="p">{</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>            <span class="s1">&#39;exc&#39;</span><span class="p">:</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>            <span class="s1">&#39;tickers&#39;</span><span class="p">:</span><span class="n">tickers</span><span class="p">,</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>            <span class="s1">&#39;_start&#39;</span><span class="p">:</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>            <span class="s1">&#39;_end&#39;</span><span class="p">:</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>            <span class="s1">&#39;params&#39;</span><span class="p">:</span><span class="n">replayer_configs</span><span class="p">,</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>        <span class="p">},</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>        <span class="s1">&#39;dict&#39;</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    <span class="p">))</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>    <span class="n">statistics</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">statistics</span><span class="p">()</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>    <span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;stats&#39;</span><span class="p">,</span><span class="n">statistics</span><span class="p">,</span><span class="s1">&#39;dict&#39;</span><span class="p">))</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>    <span class="n">df_exchange</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">df_exchange</span><span class="p">(</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="n">exchange_plot</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">)</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>    <span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;perf[inventory]&#39;</span><span class="p">,</span><span class="n">df_exchange</span><span class="p">,</span><span class="s1">&#39;df&#39;</span><span class="p">))</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>    <span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;perf[inventory]&#39;</span><span class="p">,</span><span class="n">exchange_plot</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">))</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>    <span class="n">df_markouts</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">df_markouts</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="n">markouts_plot</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">)</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>    <span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;markouts&#39;</span><span class="p">,</span><span class="n">markouts_plot</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">))</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>    <span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>        <span class="n">save</span> <span class="o">=</span> <span class="n">prices_plot</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span><span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">)</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>        <span class="n">df_prices</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">df_prices</span><span class="p">(</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>            <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="n">save</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>        <span class="p">)</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>        <span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;fills&#39;</span><span class="p">,</span><span class="n">save</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">))</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>    <span class="n">norm_pnls</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">df_counterparty_pnl</span><span class="p">(</span><span class="n">exc_tickers</span><span class="o">=</span><span class="n">stream_data</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="n">counterparty_plot</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">)</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>    <span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;counterparty_pnl&#39;</span><span class="p">,</span><span class="n">counterparty_plot</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">))</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>    <span class="n">pdf_snapshot</span><span class="p">(</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>        <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">,</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>        <span class="n">code_file</span><span class="o">=</span><span class="vm">__file__</span><span class="p">,</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>        <span class="n">report_data</span><span class="o">=</span><span class="n">report_data</span><span class="p">,</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>        <span class="n">include_comments</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>    <span class="p">)</span>
</code></pre></div>
<p>The <code>replayer.statistics()</code> gives us simulation stats:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>{&#39;binance&#39;: None,
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a> &#39;bybit&#39;: {&#39;#trades&#39;: 59,
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>           &#39;0s Markouts&#39;:   0s   -0.000015
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>                            0s   -0.000015
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>                            dtype: float64,
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>           &#39;11s Markouts&#39;: -7.368662532822541e-06,
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>           &#39;Tick Markouts&#39;: -1.540771245685202e-05,
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>           &#39;flip_win_ratio&#39;: 0.6,
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>           &#39;interval_quartiles&#39;: [&#39;0s&#39;, &#39;0s&#39;, &#39;11s&#39;],
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>           &#39;inventory_flips&#39;: 5,
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>           &#39;max_leverage&#39;: 0.04,
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>           &#39;max_norm_beta&#39;: 0.04,
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>           &#39;maxdd(%)&#39;: 0.03,
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>           &#39;pnl&#39;: -0.14,
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>           &#39;roi&#39;: -0.0,
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>           &#39;sharpe&#39;: -7.76,
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>           &#39;terminal&#39;: 9999.86,
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>           &#39;turnover&#39;: 0.39,
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>           &#39;volume&#39;: Decimal(&#39;3899.41&#39;),
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>           &#39;volume/s($)&#39;: Decimal(&#39;0.65&#39;)}}
</code></pre></div></p>
<p>The <code>replayer.df_exchange()</code> gives us dataframe and plot on exchange performance - the pnl, inventory breakdown (in our case, only one ticker was quoted so net inventory is just one market):
<img alt="alt text" src="../../archives/df_exchange.png" />
We can see that our inventory management was somewhat effective, and our pnl is flat.</p>
<p>The <code>replayer.df_markouts()</code> gives us markouts on the next tick and more than a few minutes out.
<img alt="alt text" src="../../archives/df_markouts.png" /></p>
<p>The <code>replayer.df_prices()</code> gives us prices overlayed with inventory and fills:
<img alt="alt text" src="../../archives/df_prices.png" /></p>
<p>The <code>replayer.df_counterparty_pnl()</code> gives us the normalized (across exchange and time axis) pnl from taking on all of the taker order flow on that exchange market. One might argue that the market maker's role is to aim to achieve a positively biased (or at least non-adverse) sample of this order flow. 
<img alt="alt text" src="../../archives/df_counterparty_pnl.png" /></p>
<h2 id="open-research-standard">Open Research Standard</h2>
<p>The code lines in the previous <a href="#simulation-report-ors">section</a> help to generate an ORS report. It takes the file path to save, the implementation file, as well as report data which takes types of <code>df</code>, <code>img</code>, or <code>dict</code> to render.
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>pdf_snapshot(
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    save=f&#39;{folder}/{datetime.now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)}.pdf&#39;,
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    code_file=__file__,
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    report_data=report_data,
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    include_comments=False
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>)
</code></pre></div>
Here is the <a href="https://github.com/hangukquant/hangukquant.github.io/blob/master/archives/ors.pdf">ORS generated</a> from the above script.</p>
<h2 id="modelling">Modelling</h2>
<p>Please refer to the <a href="#live-simulation-modes">previous section</a> on market making in simulation and live environments to get an appreciation of the replayer class.
This would make modelling extremely simple. In fact, we only need to change one function.</p>
<p>For demonstration, we would like to assess the effectiveness of VAMP (volume adjusted mid price) in short term price prediction - as well as compare between different notional values as parameter to the depth of order book pressure relevant in VAMP models.</p>
<p>We begin with the imports:
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">import</span> <span class="nn">os</span> 
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">import</span> <span class="nn">pytz</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kn">import</span> <span class="nn">asyncio</span> 
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kn">import</span> <span class="nn">logging</span> 
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="kn">import</span> <span class="nn">argparse</span> 
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> 
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="n">load_dotenv</span><span class="p">()</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="kn">from</span> <span class="nn">quantpylib.hft.oms</span> <span class="kn">import</span> <span class="n">OMS</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="kn">from</span> <span class="nn">quantpylib.hft.feed</span> <span class="kn">import</span> <span class="n">Feed</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="kn">from</span> <span class="nn">quantpylib.gateway.master</span> <span class="kn">import</span> <span class="n">Gateway</span> 
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="kn">from</span> <span class="nn">quantpylib.utilities.general</span> <span class="kn">import</span> <span class="n">_time</span><span class="p">,</span><span class="n">pdf_snapshot</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="n">show</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="n">simulated</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="n">config_keys</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>    <span class="s2">&quot;binance&quot;</span><span class="p">:{},</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="p">}</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="n">exc</span> <span class="o">=</span> <span class="s1">&#39;binance&#39;</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="n">tickers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SOLUSDT&quot;</span><span class="p">]</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="n">stream_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>    <span class="s2">&quot;binance&quot;</span><span class="p">:[</span><span class="s2">&quot;SOLUSDT&quot;</span><span class="p">],</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="p">}</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="n">run</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="n">replayer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="n">print_interval</span> <span class="o">=</span> <span class="mi">120</span> <span class="o">*</span> <span class="mi">1000</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="k">if</span> <span class="n">simulated</span><span class="p">:</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>    <span class="kn">from</span> <span class="nn">quantpylib.hft.mocks</span> <span class="kn">import</span> <span class="n">Replayer</span><span class="p">,</span><span class="n">Latencies</span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>    <span class="n">start</span><span class="o">=</span><span class="s1">&#39;2025-01-10:01&#39;</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>    <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2025-01-10:05&#39;</span>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>    <span class="n">latencies</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">REQ_PUBLIC</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">REQ_PRIVATE</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">ACK_PUBLIC</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">ACK_PRIVATE</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">FEED_PUBLIC</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a>        <span class="n">Latencies</span><span class="o">.</span><span class="n">FEED_PRIVATE</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a>    <span class="p">}</span>
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a>    <span class="n">replayer_configs</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>        <span class="s2">&quot;maker_fees&quot;</span><span class="p">:</span><span class="mf">0.000</span><span class="p">,</span>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>        <span class="s2">&quot;taker_fees&quot;</span><span class="p">:</span><span class="mf">0.000</span><span class="p">,</span>
<a id="__codelineno-11-50" name="__codelineno-11-50" href="#__codelineno-11-50"></a>        <span class="s2">&quot;latencies&quot;</span><span class="p">:</span><span class="n">latencies</span><span class="p">,</span>
<a id="__codelineno-11-51" name="__codelineno-11-51" href="#__codelineno-11-51"></a>    <span class="p">}</span>
<a id="__codelineno-11-52" name="__codelineno-11-52" href="#__codelineno-11-52"></a>
<a id="__codelineno-11-53" name="__codelineno-11-53" href="#__codelineno-11-53"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-54" name="__codelineno-11-54" href="#__codelineno-11-54"></a>    <span class="n">run</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1e9</span><span class="p">)</span>
<a id="__codelineno-11-55" name="__codelineno-11-55" href="#__codelineno-11-55"></a>    <span class="n">time</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">_time</span><span class="p">()</span>
<a id="__codelineno-11-56" name="__codelineno-11-56" href="#__codelineno-11-56"></a>
<a id="__codelineno-11-57" name="__codelineno-11-57" href="#__codelineno-11-57"></a><span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">(</span><span class="n">config_keys</span><span class="o">=</span><span class="n">config_keys</span><span class="p">)</span>
</code></pre></div>
The functions 
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">hft</span><span class="p">(</span><span class="n">replayer</span><span class="p">,</span><span class="n">oms</span><span class="p">,</span><span class="n">feed</span><span class="p">):</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="k">pass</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">sim_prepare</span><span class="p">():</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    <span class="k">pass</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="k">pass</span>
</code></pre></div>
remain unchanged from the previous section. Obviously, we are not submitting order actions and backtesting a hft-strategy. Rather, we are doing some quantitative analysis on replayed tick data. We would have to modify the <code>quote_markets</code> function. Again, we can choose to act on trade ticks, orderbook ticks, or clock ticks. We will stay with the orderbook ticks. This is both extremely simple and self-explanatory:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">quote_markets</span><span class="p">(</span><span class="n">replayer</span><span class="p">,</span><span class="n">oms</span><span class="p">,</span><span class="n">feed</span><span class="p">,</span><span class="n">ticker</span><span class="p">):</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">last_print</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">l2_handler</span><span class="p">(</span><span class="n">lob</span><span class="p">):</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>        <span class="k">nonlocal</span> <span class="n">last_print</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        <span class="n">stamp</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>        <span class="n">stamp</span> <span class="o">=</span> <span class="n">stamp</span> <span class="o">-</span> <span class="p">(</span><span class="n">stamp</span> <span class="o">%</span> <span class="n">print_interval</span><span class="p">)</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>        <span class="k">if</span> <span class="n">stamp</span> <span class="o">!=</span> <span class="n">last_print</span><span class="p">:</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span><span class="n">tz</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>            <span class="n">last_print</span> <span class="o">=</span> <span class="n">stamp</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>        <span class="k">for</span> <span class="n">vamp</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">]:</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>            <span class="n">replayer</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>                <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;vamp</span><span class="si">{</span><span class="n">vamp</span><span class="si">}</span><span class="s1">k&#39;</span><span class="p">,</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>                <span class="n">value</span><span class="o">=</span><span class="n">lob</span><span class="o">.</span><span class="n">get_vamp</span><span class="p">(</span><span class="n">vamp</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>                <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>                <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>                <span class="n">group</span><span class="o">=</span><span class="s1">&#39;vamp&#39;</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>            <span class="p">)</span>    
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>    <span class="n">l2_feed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">feed</span><span class="o">.</span><span class="n">add_l2_book_feed</span><span class="p">(</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>        <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>        <span class="n">ticker</span><span class="o">=</span><span class="n">ticker</span><span class="p">,</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>        <span class="n">depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>        <span class="n">buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>        <span class="n">handler</span><span class="o">=</span><span class="n">l2_handler</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>    <span class="p">)</span>
</code></pre></div>
It is not difficult to understand this, if the last section has been perused.
The additional method is the <code>declare</code> method, which takes in key-value arguments for arbitrary random variable and corresponding realised estimate. The <code>exc</code>, <code>ticker</code> and <code>group</code> are optional labels, and it would come in very handy.</p>
<p>That's it! After the replay is done in the <code>hft</code> coroutine, we would do our analysis in the <code>sim_report</code> implementation:
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">sim_report</span><span class="p">(</span><span class="n">replayer</span><span class="p">):</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;./logs/reports&#39;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="n">fairprices_plot</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/fairprices.png&#39;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="n">regression_plot</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/regression.png&#39;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="n">regression_influence</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/regression_influence.png&#39;</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">price_plot</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/prices.png&#39;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="c1">#see plots and reports</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="n">report_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>    <span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>        <span class="s1">&#39;configs&#39;</span><span class="p">,</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>        <span class="p">{</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>            <span class="s1">&#39;exc&#39;</span><span class="p">:</span><span class="n">exc</span><span class="p">,</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>            <span class="s1">&#39;tickers&#39;</span><span class="p">:</span><span class="n">tickers</span><span class="p">,</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>            <span class="s1">&#39;_start&#39;</span><span class="p">:</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>            <span class="s1">&#39;_end&#39;</span><span class="p">:</span><span class="n">end</span><span class="p">,</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>            <span class="s1">&#39;params&#39;</span><span class="p">:</span><span class="n">replayer_configs</span><span class="p">,</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>        <span class="p">},</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>        <span class="s1">&#39;dict&#39;</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>    <span class="p">))</span>
</code></pre></div>
In our very specific case, the VAMP is actually a fairprice estimator random variable (it is a predictor for future prices). The <code>Replayer</code> class provides utility functions to compare different fairprice estimators sharing the <code>group</code> label:
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">metrics_df</span><span class="p">,</span> <span class="n">declarations</span><span class="p">,</span> <span class="n">error_dfs</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">df_fairprices</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;vamp&#39;</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;fairprice metrics&#39;</span><span class="p">,</span><span class="n">metrics_df</span><span class="p">,</span><span class="s1">&#39;df&#39;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>                  <span class="n">Q1</span><span class="p">(</span><span class="n">e</span><span class="o">%</span><span class="p">)</span>    <span class="n">Q3</span><span class="p">(</span><span class="n">e</span><span class="o">%</span><span class="p">)</span>  <span class="n">MEDIAN</span><span class="p">(</span><span class="n">e</span><span class="o">%</span><span class="p">)</span>  <span class="n">MEAN</span><span class="p">(</span><span class="n">e</span><span class="o">%</span><span class="p">)</span>   <span class="n">MSE</span><span class="p">(</span><span class="n">e</span><span class="o">%</span><span class="p">)</span>   <span class="n">MAD</span><span class="p">(</span><span class="n">e</span><span class="o">%</span><span class="p">)</span> <span class="n">MSE</span><span class="o">*</span> <span class="n">MAD</span><span class="o">*</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">T</span><span class="o">+</span>   <span class="n">Estimator</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">t0</span>   <span class="n">vamp100k</span>  <span class="o">-</span><span class="mf">0.003743</span>  <span class="mf">0.002893</span>   <span class="o">-</span><span class="mf">0.000325</span> <span class="o">-</span><span class="mf">0.000447</span>  <span class="mf">0.000018</span>  <span class="mf">0.003568</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>     <span class="n">vamp10k</span>    <span class="mf">0.000000</span>  <span class="mf">0.000000</span>    <span class="mf">0.000000</span>  <span class="mf">0.000001</span>  <span class="mf">0.000002</span>  <span class="mf">0.000679</span>    <span class="o">*</span>    <span class="o">*</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>     <span class="n">vamp200k</span>  <span class="o">-</span><span class="mf">0.004440</span>  <span class="mf">0.002503</span>   <span class="o">-</span><span class="mf">0.000950</span> <span class="o">-</span><span class="mf">0.001001</span>  <span class="mf">0.000022</span>  <span class="mf">0.003854</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>     <span class="n">vamp30k</span>   <span class="o">-</span><span class="mf">0.001454</span>  <span class="mf">0.001460</span>    <span class="mf">0.000000</span> <span class="o">-</span><span class="mf">0.000041</span>  <span class="mf">0.000007</span>  <span class="mf">0.001949</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>     <span class="n">vamp50k</span>   <span class="o">-</span><span class="mf">0.002563</span>  <span class="mf">0.002393</span>    <span class="mf">0.000000</span> <span class="o">-</span><span class="mf">0.000140</span>  <span class="mf">0.000011</span>  <span class="mf">0.002774</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="n">t1</span>   <span class="n">vamp100k</span>  <span class="o">-</span><span class="mf">0.004179</span>  <span class="mf">0.003159</span>   <span class="o">-</span><span class="mf">0.000457</span> <span class="o">-</span><span class="mf">0.000401</span>  <span class="mf">0.000060</span>  <span class="mf">0.005186</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>     <span class="n">vamp10k</span>   <span class="o">-</span><span class="mf">0.000214</span>  <span class="mf">0.000000</span>    <span class="mf">0.000000</span>  <span class="mf">0.000047</span>  <span class="mf">0.000059</span>  <span class="mf">0.003743</span>         <span class="o">*</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>     <span class="n">vamp200k</span>  <span class="o">-</span><span class="mf">0.004891</span>  <span class="mf">0.002762</span>   <span class="o">-</span><span class="mf">0.001088</span> <span class="o">-</span><span class="mf">0.000955</span>  <span class="mf">0.000062</span>  <span class="mf">0.005395</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>     <span class="n">vamp30k</span>   <span class="o">-</span><span class="mf">0.002253</span>  <span class="mf">0.001967</span>    <span class="mf">0.000000</span>  <span class="mf">0.000005</span>  <span class="mf">0.000057</span>  <span class="mf">0.004318</span>    <span class="o">*</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>     <span class="n">vamp50k</span>   <span class="o">-</span><span class="mf">0.003128</span>  <span class="mf">0.002764</span>   <span class="o">-</span><span class="mf">0.000100</span> <span class="o">-</span><span class="mf">0.000094</span>  <span class="mf">0.000057</span>  <span class="mf">0.004751</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="n">t10</span>  <span class="n">vamp100k</span>  <span class="o">-</span><span class="mf">0.024027</span>  <span class="mf">0.023172</span>   <span class="o">-</span><span class="mf">0.000856</span>  <span class="mf">0.000551</span>  <span class="mf">0.001625</span>  <span class="mf">0.030386</span>    <span class="o">*</span>    <span class="o">*</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>     <span class="n">vamp10k</span>   <span class="o">-</span><span class="mf">0.023463</span>  <span class="mf">0.023515</span>    <span class="mf">0.000000</span>  <span class="mf">0.000999</span>  <span class="mf">0.001644</span>  <span class="mf">0.030497</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>     <span class="n">vamp200k</span>  <span class="o">-</span><span class="mf">0.024568</span>  <span class="mf">0.022738</span>   <span class="o">-</span><span class="mf">0.001454</span> <span class="o">-</span><span class="mf">0.000003</span>  <span class="mf">0.001626</span>  <span class="mf">0.030429</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>     <span class="n">vamp30k</span>   <span class="o">-</span><span class="mf">0.023469</span>  <span class="mf">0.023481</span>   <span class="o">-</span><span class="mf">0.000109</span>  <span class="mf">0.000957</span>  <span class="mf">0.001632</span>  <span class="mf">0.030412</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="o">...</span><span class="n">TRUNCATED</span> <span class="n">OUTPUT</span> <span class="n">FOR</span> <span class="n">DIFFERENT</span> <span class="n">FORWARD</span> <span class="n">INTERVALS</span> <span class="n">T</span><span class="p">(</span><span class="n">SECONDS</span><span class="p">)</span>
</code></pre></div>
The <code>*</code> represents the best estimator for that forward looking interval. We can see that the lowest notional vamp (closest to mid-price) is the best estimator for the next-tick mid price, and that deeper levels of orderbook pressure are favorable for longer-time horizons.</p>
<p>We may also be working with non-fairprice estimators, and want to simply retrieve our declarations (arguments are optional filters)
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">declarations</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">df_declarations</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;vamp100k&#39;</span><span class="p">,</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span><span class="n">ticker</span><span class="o">=</span><span class="s1">&#39;SOLUSDT&#39;</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;vamp&#39;</span><span class="p">)</span>
</code></pre></div>
and we get:
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>                  ts       key       value      exc   ticker group
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>0      1736470799934  vamp100k  186.327409  binance  SOLUSDT  vamp
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>1      1736470800444  vamp100k  186.341816  binance  SOLUSDT  vamp
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>2      1736470800954  vamp100k  186.297270  binance  SOLUSDT  vamp
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>3      1736470801458  vamp100k  186.264105  binance  SOLUSDT  vamp
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>4      1736470801962  vamp100k  186.252672  binance  SOLUSDT  vamp
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>...              ...       ...         ...      ...      ...   ...
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>35006  1736488797277  vamp100k  189.794952  binance  SOLUSDT  vamp
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>35007  1736488797865  vamp100k  189.794885  binance  SOLUSDT  vamp
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>35008  1736488798422  vamp100k  189.794705  binance  SOLUSDT  vamp
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>35009  1736488798942  vamp100k  189.794743  binance  SOLUSDT  vamp
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>35010  1736488799447  vamp100k  189.787968  binance  SOLUSDT  vamp
</code></pre></div>
Often the thing we are interested is how the value of these random variables relate to future prices. We can pass to the replayer a dataframe with <code>ts</code> column to get our answer (works with multiple tickers and multiple exchanges):
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">forward_prices</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">augment_forward_prices</span><span class="p">(</span><span class="n">declarations</span><span class="p">)</span>
</code></pre></div>
for
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>                  ts       key       value      exc  ...      t30      t60     t120     t300        
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>0      1736470799934  vamp100k  186.327409  binance  ...  186.435  186.445  186.555  186.865        
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>1      1736470800444  vamp100k  186.341816  binance  ...  186.435  186.445  186.555  186.865        
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>2      1736470800954  vamp100k  186.297270  binance  ...  186.435  186.425  186.555  186.865        
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>3      1736470801458  vamp100k  186.264105  binance  ...  186.435  186.425  186.575  186.865        
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>4      1736470801962  vamp100k  186.252672  binance  ...  186.355  186.425  186.575  186.865        
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>...              ...       ...         ...      ...  ...      ...      ...      ...      ...        
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>34421  1736488497123  vamp100k  189.715000  binance  ...  189.565  189.605  189.555  189.785
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>34422  1736488497635  vamp100k  189.715000  binance  ...  189.565  189.605  189.555  189.785
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>34423  1736488498179  vamp100k  189.715000  binance  ...  189.565  189.605  189.565  189.785
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>34424  1736488498701  vamp100k  189.715000  binance  ...  189.565  189.605  189.565  189.785
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>34425  1736488499204  vamp100k  189.712113  binance  ...  189.565  189.605  189.565  189.785
</code></pre></div>
With this dataframe, we are free to build any statistical model with the regression variables. Let us perform a least-squares regression for future price changes against the vamp-to-mid ratio. Although we don't have to normalize by price (only a single market and short timeframe is considered) - we shall do so. Using the <a href="../../simulator/simulator/#regression-analysis"><code>GeneticRegression</code></a>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kn">from</span> <span class="nn">quantpylib.simulator.models</span> <span class="kn">import</span> <span class="n">GeneticRegression</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">model</span> <span class="o">=</span> <span class="n">GeneticRegression</span><span class="p">(</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>    <span class="n">formula</span><span class="o">=</span><span class="s1">&#39;div(minus(t60,t0),t0) ~ div(minus(value,t0),t0)&#39;</span><span class="p">,</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>    <span class="n">intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>    <span class="n">df</span><span class="o">=</span><span class="n">forward_prices</span><span class="p">,</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="p">)</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="n">regression</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">ols</span><span class="p">()</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;regression results&#39;</span><span class="p">,{</span><span class="s1">&#39;summary&#39;</span><span class="p">:</span><span class="n">regression</span><span class="o">.</span><span class="n">summary</span><span class="p">()},</span><span class="s1">&#39;dict&#39;</span><span class="p">))</span>
</code></pre></div>
gives us strong statistical significance:
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>                                 OLS Regression Results
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>=======================================================================================
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>Dep. Variable:                     b0   R-squared (uncentered):                   0.003
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>Model:                            OLS   Adj. R-squared (uncentered):              0.003
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>Method:                 Least Squares   F-statistic:                              110.5
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>Date:                Sun, 19 Jan 2025   Prob (F-statistic):                    8.20e-26
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>Time:                        16:15:01   Log-Likelihood:                      1.8701e+05
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>No. Observations:               34426   AIC:                                 -3.740e+05
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>Df Residuals:                   34425   BIC:                                 -3.740e+05
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>Df Model:                           1
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>Covariance Type:            nonrobust
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>==============================================================================
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>                 coef    std err          t      P&gt;|t|      [0.025      0.975]
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>------------------------------------------------------------------------------
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>b1             1.4135      0.134     10.513      0.000       1.150       1.677
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>==============================================================================
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>Omnibus:                       80.864   Durbin-Watson:                   0.014
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>Prob(Omnibus):                  0.000   Jarque-Bera (JB):               81.384
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>Skew:                           0.118   Prob(JB):                     2.13e-18
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>Kurtosis:                       3.036   Cond. No.                         1.00
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>==============================================================================
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>Notes:
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>[1] R is computed without centering (uncentered) since the model does not contain a constant.
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>[2] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</code></pre></div>
For our plots, we would like to do some aggregation for better readability of the plot - we do data binning and save regression and influence plots:
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">model</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span><span class="n">save_fit</span><span class="o">=</span><span class="n">regression_plot</span><span class="p">,</span><span class="n">save_influence</span><span class="o">=</span><span class="n">regression_influence</span><span class="p">)</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;regression (binned)&#39;</span><span class="p">,</span><span class="n">regression_plot</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">))</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;regression (binned)&#39;</span><span class="p">,</span><span class="n">regression_influence</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">))</span>
</code></pre></div>
which gives plot:
<img alt="alt text" src="../../archives/vamp_regression.png" />
and other plots like the influence and residual plots.</p>
<p>In this case, the 'indicator' share the same scale as prices themselves, so we can visualize them on the same axis. For other indicators with difference ranges (e.g. trade imbalance, returns, stochastic oscillator) we can overlay them on the price chart with a twin axis <code>share_index=False</code>  :
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">df_prices</span> <span class="o">=</span> <span class="n">replayer</span><span class="o">.</span><span class="n">df_prices</span><span class="p">(</span><span class="n">ticker</span><span class="o">=</span><span class="s1">&#39;SOLUSDT&#39;</span><span class="p">,</span><span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="n">price_plot</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;vamp100k&#39;</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;vamp&#39;</span><span class="p">,</span><span class="n">share_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">report_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;prices&#39;</span><span class="p">,</span><span class="n">price_plot</span><span class="p">,</span><span class="s1">&#39;img&#39;</span><span class="p">))</span>
</code></pre></div>
Last but not least - we can make a ORS report:
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">pdf_snapshot</span><span class="p">(</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>    <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H-%M-%S&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">,</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>    <span class="n">code_file</span><span class="o">=</span><span class="vm">__file__</span><span class="p">,</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    <span class="n">report_data</span><span class="o">=</span><span class="n">report_data</span><span class="p">,</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="n">include_comments</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="p">)</span>
</code></pre></div>
<a href="https://github.com/hangukquant/hangukquant.github.io/blob/master/archives/vamp.pdf">shown here</a>.</p>
<p>Happy making, makers.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 <a href="https://hangukquant.com"  target="_blank" rel="noopener">Quanta Global Pte. Ltd. 202328387H - All Rights Reserved.</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/hangukquant" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>