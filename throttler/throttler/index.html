
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../hft/utils/">
      
      
        <link rel="next" href="../aiohttp/">
      
      
      <link rel="icon" href="../../icons/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>quantpylib.throttler - quantpylib</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#examples" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="quantpylib" class="md-header__button md-logo" aria-label="quantpylib" data-md-component="logo">
      
  <img src="../../icons/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            quantpylib
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              quantpylib.throttler
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../simulator/simulator/" class="md-tabs__link">
          
  
  
  User Documentation

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../pricing/pricing/" class="md-tabs__link">
          
  
  
  Pricing

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../scripts/market_making/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../learn/learn/" class="md-tabs__link">
          
  
  
  Learn

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../bounties/" class="md-tabs__link">
          
  
  
  Bounties

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="quantpylib" class="md-nav__button md-logo" aria-label="quantpylib" data-md-component="logo">
      
  <img src="../../icons/logo.png" alt="logo">

    </a>
    quantpylib
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    User Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    quantpylib
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            quantpylib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    quantpylib.simulator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.simulator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/simulator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.simulator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/alpha/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.simulator.alpha
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/gene/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.simulator.gene
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.simulator.models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/operators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.simulator.operators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulator/performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.simulator.performance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    quantpylib.hft
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.hft
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/hft/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/feed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft.feed
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/oms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft.oms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/mocks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft.mocks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/bars/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft.bars
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/lob/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft.lob
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/trades/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft.trades
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft.features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft.stats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hft/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.hft.utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    quantpylib.throttler
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.throttler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    quantpylib.throttler
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    quantpylib.throttler
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aiosonic-client" class="md-nav__link">
    <span class="md-ellipsis">
      Aiosonic Client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rate-semaphore" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Semaphore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Semaphore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#synchronous-example" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronous Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#easy-with-decorators" class="md-nav__link">
    <span class="md-ellipsis">
      Easy with Decorators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asynchronous-example" class="md-nav__link">
    <span class="md-ellipsis">
      Asynchronous Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#easy-with-decorators_1" class="md-nav__link">
    <span class="md-ellipsis">
      Easy with Decorators
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes-on-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Notes on Behavior
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aiohttp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.throttler.aiohttp
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aiosonic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.throttler.aiosonic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../httpx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.throttler.httpx
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rate_semaphore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.throttler.rate_semaphore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decorators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.throttler.decorators
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4" >
        
          
          <label class="md-nav__link" for="__nav_2_1_4" id="__nav_2_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    quantpylib.utilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.utilities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/general/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.utilities.general
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/math/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.utilities.math
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utilities/cringbuffer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.utilities.cringbuffer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5" >
        
          
          <label class="md-nav__link" for="__nav_2_1_5" id="__nav_2_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_5">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.datapoller
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/datapoller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/master/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller.master
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller.utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller.base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/crypto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller.crypto
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/currencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller.currencies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/equities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller.equities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/exchange/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller.exchange
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../datapoller/metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.datapoller.metadata
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_6" >
        
          
          <label class="md-nav__link" for="__nav_2_1_6" id="__nav_2_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    quantpylib.gateway
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_6">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.gateway
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/gateway/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.gateway
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/account/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.gateway.account
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.gateway.base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/exchange/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.gateway.exchange
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.gateway.executor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/master/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.gateway.master
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/orders/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.gateway.orders
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/positions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.gateway.positions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.gateway.utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_7" >
        
          
          <label class="md-nav__link" for="__nav_2_1_7" id="__nav_2_1_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    quantpylib.standards
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_7">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.standards
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/standards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.standards
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/intervals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.standards.intervals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/markets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.standards.markets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standards/portfolio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.standards.portfolio
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_8" >
        
          
          <label class="md-nav__link" for="__nav_2_1_8" id="__nav_2_1_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_8">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.wrappers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/wrappers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/binance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers.binance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/bybit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers.bybit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/hyperliquid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers.hyperliquid
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/paradex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers.paradex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/woox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers.woox
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/polymarket/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers.polymarket
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/eodhd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers.eodhd
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/oanda/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers.oanda
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wrappers/yfinance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.wrappers.yfinance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_9" >
        
          
          <label class="md-nav__link" for="__nav_2_1_9" id="__nav_2_1_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    quantpylib.logger
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_9">
            <span class="md-nav__icon md-icon"></span>
            quantpylib.logger
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logger/logger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.logger
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logger/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.logger.utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logger/formatters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.logger.formatters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logger/handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    quantpylib.logger.handlers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pricing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Pricing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pricing/pricing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pricing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../scripts/market_making/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Market Maker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../scripts/tick_archival/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tick Archival
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../scripts/trend_following/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trend Follower
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Learn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Learn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learn/learn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Learn
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learn/scientific_programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scientific Programming
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bounties
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Bounties
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bounties/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bounties
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="throttler"><a href=".">throttler</a></h1>

<p>This page describes how you may use our <code>quantpylib.throttler</code> module and the functionalities exposed by our APIs. This module contains classes meant for synchronizing, throttling and handling tasks such as network requests efficiently.</p>
<p><a href="../aiosonic"><code>quantpylib.throttler.aiosonic</code></a> features a HTTP client written on top of <a href="https://aiosonic.readthedocs.io/en/latest/examples.html"><code>aiosonic</code></a> and <a href="https://github.com/ijl/orjson"><code>orjson</code></a>, acting as an asynchronous HTTP library optimizing the speed of HTTP requests and handling of data packets.</p>
<p><a href="../rate_semaphore"><code>quantpylib.throttler.rate_semaphore</code></a> features both synchronous and asynchronous support for rate-limiting access to function calls via a credit-based semaphore synchronization tool. A simple but common use would be to maximise throughput of API requests to an external server that places rate-limits on the number of API requests per minute/hour with request credits charged against a resource pool. This is made available through the <a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.RateSemaphore"><code>RateSemaphore</code></a> and <a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.AsyncRateSemaphore"><code>AsyncRateSemaphore</code></a> classes - and can be seen as an extension of the synchronization 
primitives <a href="https://github.com/python/cpython/blob/main/Lib/threading.py"><code>threading.Semaphore</code></a> and <a href="https://github.com/python/cpython/blob/main/Lib/asyncio/locks.py"><code>asyncio.locks.Semaphore</code></a> in the Python standard library respectively.
The <a href="../decorators"><code>quantpylib.throttler.decorators</code></a> module provides decorators for instance methods that wraps threads and coroutines to provide seamless integration with the synchronization features.</p>
<p><a href="../aiohttp"><code>quantpylib.throttler.aiohttp</code></a> features utility functions to batch asynchronous network requests using <a href="https://docs.aiohttp.org/en/stable/"><code>aiohttp</code></a> client sessions and optionally, semaphores.</p>
<p>A high-level walkthrough of the individual quant packages are presented in this page. Comprehensive documentation may be found in the respective pages. To follow along, make sure you have installed the necessary <a href="../../#installation">dependencies</a>.
Code example scripts are also provided in the repo.</p>
<h2 id="examples">Examples</h2>
<h3 id="aiosonic-client">Aiosonic Client</h3>
<p>The module is an efficiency-optimized HTTP request library. The usage is extremely simple.
Let's import some HTTP clients for comparison:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span><span class="o">,</span><span class="w"> </span><span class="nn">aiohttp</span><span class="o">,</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">quantpylib.throttler.aiosonic</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTTPClient</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">quantpylib.utilities.general</span><span class="w"> </span><span class="kn">import</span> <span class="n">stopwatch</span>
</code></pre></div>
It is simple to create our <code>HTTPClient</code>. Let's set up some parameters for request:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.hyperliquid.xyz&quot;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">http_client</span> <span class="o">=</span> <span class="n">HTTPClient</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span><span class="s2">&quot;/info&quot;</span><span class="p">,</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="s2">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="s2">&quot;data&quot;</span><span class="p">:{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;meta&quot;</span><span class="p">}</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="p">}</span>
</code></pre></div>
We want to poll for perpeutals metadata on hyperliquid server. It is as simple as:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">request</span><span class="p">))</span>
</code></pre></div>
The client knows to take base url and endpoint provided to send a POST request to the hyperliquid server. The data payload 
can be sent as dictionary or string - if sent as dictionary the payload is serialized using the efficient <code>orjson</code> package,
as is deserialization of the returned data packet. Of course, all methods such as GET, POST, PUT and DELETE are supported.
Let's compare how this fares against other HTTP clients, using the timer from <code>quantpylib.utilities.general</code>.
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_aiohttp_request</span><span class="p">(</span><span class="n">session</span><span class="p">,</span><span class="n">url</span><span class="p">,</span><span class="n">payload</span><span class="p">):</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">**</span><span class="n">request</span><span class="p">))</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="k">await</span> <span class="n">timers</span><span class="p">()</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">timers</span><span class="p">():</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>        
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#39;</span><span class="p">)</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>            <span class="k">await</span> <span class="n">stopwatch</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">)(</span><span class="n">http_client</span><span class="o">.</span><span class="n">request</span><span class="p">)(</span><span class="o">**</span><span class="n">request</span><span class="p">),</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>            <span class="n">stopwatch</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">)(</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">)(</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>                <span class="n">url</span> <span class="o">+</span> <span class="n">request</span><span class="p">[</span><span class="s2">&quot;endpoint&quot;</span><span class="p">],</span> 
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>                <span class="n">json</span><span class="o">=</span><span class="n">request</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span> 
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>                <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>            <span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>   
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>            <span class="k">await</span> <span class="n">stopwatch</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">)(</span><span class="n">_aiohttp_request</span><span class="p">)(</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>                <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>                <span class="n">url</span><span class="o">=</span><span class="n">url</span> <span class="o">+</span> <span class="n">request</span><span class="p">[</span><span class="s2">&quot;endpoint&quot;</span><span class="p">],</span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>                <span class="n">payload</span><span class="o">=</span><span class="n">request</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>            <span class="p">)</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#39;</span><span class="p">)</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>
An example of the timing results look like this:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>...
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>request::69ms
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>post::225ms
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>_aiohttp_request::69ms
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>request::75ms
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>post::221ms
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>_aiohttp_request::87ms
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>request::67ms
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>post::230ms
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>_aiohttp_request::82ms
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>request::77ms
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>post::226ms
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>_aiohttp_request::67ms
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>...
</code></pre></div>
It is clear that the blocking, no-cache <code>requests.post</code> method is least performant. Both our requests 
using the <code>throttler</code> client and <code>aiohttp</code> client are comparative due to cacheing and maintenance of 
the handshake - but the <code>throttler</code> library should edge out 
small performance gains due to efficient (de)serialization of messages. This is important if we are working with 
large packets. The network latency dominates in most cases, however. It is clear which library is easiest to use.</p>
<h3 id="rate-semaphore">Rate Semaphore</h3>
<p>The module is flexible enough to handle both fixed-cost endpoints (specs such as '20 API requests/min') or 
variable-cost endpoints (specs such as `5 API credits/getTick', '15 API credits/getOHLCV' with '100 credits/min per client').</p>
<p>Suppose we have a financial API endpoint that has rate limits as such:</p>
<table>
<thead>
<tr>
<th>Period</th>
<th>Credits Awarded / app</th>
</tr>
</thead>
<tbody>
<tr>
<td>10 seconds</td>
<td>40</td>
</tr>
</tbody>
</table>
<p>The API gives us 40 credits to use every 10 seconds (capped at 40 credits max).
Different endpoints can have variable credit costs, depending on the server load. </p>
<p>Suppose we have the following endpoints and their respective costs:</p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Cost (credits / req)</th>
</tr>
</thead>
<tbody>
<tr>
<td>getTick</td>
<td>20</td>
</tr>
<tr>
<td>getOHLCV</td>
<td>5..30</td>
</tr>
<tr>
<td>getPrice</td>
<td>12.5</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
<p>Both synchronous and asynchronous semaphores expose their synchronization features through the <code>semaphore.transact(...)</code> method, which have the same function signature, except 
that the first parameter to a synchronous transaction is a parameter-less function, and the first parameter to the asynchronous transaction is a coroutine. Their detailed
documentations are defined <a href="../rate_semaphore/">here</a>.</p>
<p>For the demonstration, we require the following imports:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">quantpylib.throttler.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">wrap_in_thread</span><span class="p">,</span> <span class="n">aconsume_credits</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">quantpylib.throttler.rate_semaphore</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateSemaphore</span><span class="p">,</span><span class="n">AsyncRateSemaphore</span>
</code></pre></div></p>
<h4 id="synchronous-example">Synchronous Example</h4>
<p>Let's begin with the example for the synchronous semaphore, given by the <a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.RateSemaphore"><code>RateSemaphore</code></a> class. Our objective is to maximise the throughput to a bunch of blocking requests that consume credits on some external server. To simulate blocking requests, such as a <code>requests.get</code> method, we use the <code>time.sleep</code> method.
Note that this generalizes to any blocking method.
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">getTick</span><span class="p">(</span><span class="n">work</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getTick processing </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> takes </span><span class="si">{</span><span class="n">work</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getTick processed </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">getOHLCV</span><span class="p">(</span><span class="n">work</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getOHLCV processing </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> takes </span><span class="si">{</span><span class="n">work</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getOHLCV processed </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></p>
<p>Since we want to maximise throughput, and the function calls block the main thread, we want to create the requests in multiple threads. But since sending all of these requests simultaneously in different threads would overload the market data server (giving us errors/downgraded/blacklisted), we would wrap them in rate-limited transactions and submit them to the semaphore.
Let's create some script to run some requests through the semaphore with the
<a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.RateSemaphore.transact"><code>transact</code></a> method :
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">sync_example</span><span class="p">():</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------sync with thread-----------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">sem</span> <span class="o">=</span> <span class="n">RateSemaphore</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="n">tick_req</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">getTick</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="n">ohlcv_req</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">getOHLCV</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">threads</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">sem</span><span class="o">.</span><span class="n">transact</span><span class="p">,</span><span class="n">kwargs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>            <span class="s2">&quot;lambda_func&quot;</span><span class="p">:</span><span class="k">lambda</span><span class="p">:</span> <span class="n">tick_req</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> 
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>            <span class="s2">&quot;credits&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> 
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>            <span class="s2">&quot;refund_time&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> 
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>            <span class="s2">&quot;transaction_id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="c1">#optional</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>            <span class="s2">&quot;verbose&quot;</span><span class="p">:</span><span class="kc">True</span> <span class="c1">#optional</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>        <span class="p">}),</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">sem</span><span class="o">.</span><span class="n">transact</span><span class="p">,</span><span class="n">kwargs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>            <span class="s2">&quot;lambda_func&quot;</span><span class="p">:</span><span class="k">lambda</span><span class="p">:</span> <span class="n">ohlcv_req</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> 
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>            <span class="s2">&quot;credits&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> 
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>            <span class="s2">&quot;refund_time&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> 
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>            <span class="s2">&quot;transaction_id&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="c1">#optional</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>            <span class="s2">&quot;verbose&quot;</span><span class="p">:</span><span class="kc">True</span> <span class="c1">#optional</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>        <span class="p">}),</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">sem</span><span class="o">.</span><span class="n">transact</span><span class="p">,</span><span class="n">kwargs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>            <span class="s2">&quot;lambda_func&quot;</span><span class="p">:</span><span class="k">lambda</span><span class="p">:</span> <span class="n">ohlcv_req</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> 
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>            <span class="s2">&quot;credits&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> 
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>            <span class="s2">&quot;refund_time&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> 
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>            <span class="s2">&quot;transaction_id&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> 
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>            <span class="s2">&quot;verbose&quot;</span><span class="p">:</span><span class="kc">True</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>        <span class="p">}),</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">sem</span><span class="o">.</span><span class="n">transact</span><span class="p">,</span><span class="n">kwargs</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>            <span class="s2">&quot;lambda_func&quot;</span><span class="p">:</span><span class="k">lambda</span><span class="p">:</span> <span class="n">tick_req</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> 
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>            <span class="s2">&quot;credits&quot;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> 
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>            <span class="s2">&quot;refund_time&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> 
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>            <span class="s2">&quot;transaction_id&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> 
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>            <span class="s2">&quot;verbose&quot;</span><span class="p">:</span><span class="kc">True</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>        <span class="p">}),</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>    <span class="p">]</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>    <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>    <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>    <span class="n">sync_example</span><span class="p">()</span>
</code></pre></div>
We set the verbosity flag to give us information on when the semaphore executed the transactions, so let us observe the printed information log:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>-----------------------sync with thread-----------------------
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>2024-03-28 19:16:27.105953:: TXN 1 acquiring CreditSemaphore
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>2024-03-28 19:16:27.106051:: TXN 2 acquiring CreditSemaphore
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="hll">2024-03-28 19:16:27.106083:: TXN 1 entered CreditSemaphore...
</span><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>2024-03-28 19:16:27.106161:: TXN 3 acquiring CreditSemaphore
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>2024-03-28 19:16:27.106303:: TXN 4 acquiring CreditSemaphore
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="hll">2024-03-28 19:16:27.106367:: TXN 3 entered CreditSemaphore...
</span><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>2024-03-28 19:16:27.106426:: getOHLCV processing 3 takes 4 seconds
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>2024-03-28 19:16:27.106449:: getTick processing 1 takes 5 seconds
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>2024-03-28 19:16:31.106689:: getOHLCV processed 3
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="hll">2024-03-28 19:16:31.106877:: TXN 3 exits CreditSemaphore, schedule refund in 10...
</span><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>2024-03-28 19:16:32.107982:: getTick processed 1
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>2024-03-28 19:16:32.108390:: TXN 1 exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="hll">2024-03-28 19:16:41.109162:: TXN 4 entered CreditSemaphore...
</span><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>2024-03-28 19:16:41.109260:: getTick processing 4 takes 2 seconds
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>2024-03-28 19:16:43.110862:: getTick processed 4
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>2024-03-28 19:16:43.111243:: TXN 4 exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="hll">2024-03-28 19:16:53.113011:: TXN 2 entered CreditSemaphore...
</span><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>2024-03-28 19:16:53.113060:: getOHLCV processing 2 takes 3 seconds
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>2024-03-28 19:16:56.115643:: getOHLCV processed 2
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>2024-03-28 19:16:56.115815:: TXN 2 exits CreditSemaphore, schedule refund in 10...
</code></pre></div>
It is not difficult to reason with the output. For instance, transactions 1 and 3 entered the semaphore first, while 2, 4 was placed on hold,
leaving 40 - 20 - 5 = 15 credits. No other transaction can enter the semaphore. Transaction 3 processes and completes at 31 seconds, 
but the credit is only refunded 10 seconds later. We can see that at 41 seconds, the (5) credits from transaction 3 is refunded, giving us
15 + 5 = 20 credits, enough for transaction 4 to enter the semaphore but not 2. The rest of printed log statements are easy to rationalize.</p>
<h4 id="easy-with-decorators">Easy with Decorators</h4>
<p>The <a href="#synchronous-example">example</a> given is nice but somewhat unwiedly due to having to wrap the method/function of interest first in a semaphore 
transaction, then followed by a <code>threading.Thread</code> object. In many software applications, we have a data-service layer with a poller object/SDK for API calls made to 
external servers. A simulated example looks something like this:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">_Throttler</span><span class="p">():</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">rate_semaphore</span><span class="o">=</span><span class="n">RateSemaphore</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span>
</span><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="nd">@wrap_in_thread</span><span class="p">(</span><span class="n">costs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">refund_in</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="c1">#,attrname=&quot;rate_semaphore&quot;,verbose=True (optional-defaults)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_getTick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getTick processing </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> takes </span><span class="si">{</span><span class="n">work</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getTick processed </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="nd">@wrap_in_thread</span><span class="p">(</span><span class="n">costs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">refund_in</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">attrname</span><span class="o">=</span><span class="s2">&quot;rate_semaphore&quot;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_getOHLCV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getOHLCV processing </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> takes </span><span class="si">{</span><span class="n">work</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getOHLCV processed </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
The data-access object is given one or more <a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.RateSemaphore"><code>RateSemaphore</code></a>  objects corresponding to a unique credit/resource pool. For each 
method that makes a resource-consuming request, we can decorate the function using <a href="../decorators/#quantpylib.throttler.decorators.wrap_in_thread"><code>wrap_in_thread</code></a> with the costs and refund timers as parameters.
The decorated function calls then directly return <code>threading.Thread</code> instances wrapping transactions that contain the function request, which can be activated using
the <code>threading.Thread.start</code> method.
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">sync_example</span><span class="p">():</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------sync with thread-----------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="c1">#... previous example</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------sync with decorator-----------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    <span class="n">throttler</span> <span class="o">=</span> <span class="n">_Throttler</span><span class="p">()</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    <span class="n">threads</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>        <span class="n">throttler</span><span class="o">.</span><span class="n">_getTick</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>        <span class="n">throttler</span><span class="o">.</span><span class="n">_getOHLCV</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        <span class="n">throttler</span><span class="o">.</span><span class="n">_getTick</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>        <span class="n">throttler</span><span class="o">.</span><span class="n">_getOHLCV</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    <span class="p">]</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="p">[</span><span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">]</span>
</code></pre></div>
The behavior of the semaphore is similar to the example explored in the previous <a href="#synchronous-example">example</a>. 
The printed log statements are hence presented without commentary, but may be rationalized easily.
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>----------------------sync with decorator-----------------------
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>2024-03-28 19:16:56.116058:: TXN {&#39;fn&#39;: &#39;_getTick&#39;, &#39;args&#39;: (3, 1), &#39;kwargs&#39;: {}} acquiring CreditSemaphore
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>2024-03-28 19:16:56.116154:: TXN {&#39;fn&#39;: &#39;_getOHLCV&#39;, &#39;args&#39;: (1, 2), &#39;kwargs&#39;: {}} acquiring CreditSemaphore
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>2024-03-28 19:16:56.116220:: TXN {&#39;fn&#39;: &#39;_getTick&#39;, &#39;args&#39;: (3, 1), &#39;kwargs&#39;: {}} entered CreditSemaphore...
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>2024-03-28 19:16:56.116302:: TXN {&#39;fn&#39;: &#39;_getTick&#39;, &#39;args&#39;: (3, 3), &#39;kwargs&#39;: {}} acquiring CreditSemaphore
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>2024-03-28 19:16:56.116555:: getTick processing 1 takes 3 seconds
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>2024-03-28 19:16:56.116366:: TXN {&#39;fn&#39;: &#39;_getOHLCV&#39;, &#39;args&#39;: (1, 2), &#39;kwargs&#39;: {}} entered CreditSemaphore...
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>2024-03-28 19:16:56.116515:: TXN {&#39;fn&#39;: &#39;_getOHLCV&#39;, &#39;args&#39;: (1, 4), &#39;kwargs&#39;: {}} acquiring CreditSemaphore
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>2024-03-28 19:16:56.116691:: getOHLCV processing 2 takes 1 seconds
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>2024-03-28 19:16:57.120664:: getOHLCV processed 2
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>2024-03-28 19:16:57.120879:: TXN {&#39;fn&#39;: &#39;_getOHLCV&#39;, &#39;args&#39;: (1, 2), &#39;kwargs&#39;: {}} exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>2024-03-28 19:16:59.117150:: getTick processed 1
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>2024-03-28 19:16:59.117323:: TXN {&#39;fn&#39;: &#39;_getTick&#39;, &#39;args&#39;: (3, 1), &#39;kwargs&#39;: {}} exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>2024-03-28 19:17:07.123469:: TXN {&#39;fn&#39;: &#39;_getOHLCV&#39;, &#39;args&#39;: (1, 4), &#39;kwargs&#39;: {}} entered CreditSemaphore...
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>2024-03-28 19:17:07.123532:: getOHLCV processing 4 takes 1 seconds
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>2024-03-28 19:17:08.125678:: getOHLCV processed 4
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>2024-03-28 19:17:08.126219:: TXN {&#39;fn&#39;: &#39;_getOHLCV&#39;, &#39;args&#39;: (1, 4), &#39;kwargs&#39;: {}} exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>2024-03-28 19:17:09.118384:: TXN {&#39;fn&#39;: &#39;_getTick&#39;, &#39;args&#39;: (3, 3), &#39;kwargs&#39;: {}} entered CreditSemaphore...
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>2024-03-28 19:17:09.118482:: getTick processing 3 takes 3 seconds
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>2024-03-28 19:17:12.119387:: getTick processed 3
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>2024-03-28 19:17:12.119741:: TXN {&#39;fn&#39;: &#39;_getTick&#39;, &#39;args&#39;: (3, 3), &#39;kwargs&#39;: {}} exits CreditSemaphore, schedule refund in 10...
</code></pre></div></p>
<h4 id="asynchronous-example">Asynchronous Example</h4>
<p>We now move onto the asynchronous semaphore, given by the <a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.AsyncRateSemaphore"><code>AsyncRateSemaphore</code></a> class. Our objective is to maximise the throughput to a bunch of non-blocking requests that consume credits on some external server. To simulate non-blocking requests, such as an 
<code>async with session.get</code> method of an <code>aiohttp.ClientSession</code> object or asynchronous database requests, we use the 
<code>asyncio.sleep</code> method. Note that this generalizes to any non-blocking coroutine.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">agetTick</span><span class="p">(</span><span class="n">work</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getTick processing </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> takes </span><span class="si">{</span><span class="n">work</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getTick processed </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">agetOHLCV</span><span class="p">(</span><span class="n">work</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getOHLCV processing </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> takes </span><span class="si">{</span><span class="n">work</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getOHLCV processed </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
<p>Since we want to maximise throughput, and the function calls are coroutines that do not block 
the main thread, we want to create the requests concurrently and place them on the event loop.
But since sending all of these requests simultaneously in different coroutines would overload the market data server (giving us errors/downgraded/blacklisted), we would wrap them in rate-limited transactions and submit them to the semaphore.
Let's create some script to run some request transactions through the semaphore:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">async_example</span><span class="p">():</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------async with transactions-----------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">sem</span> <span class="o">=</span> <span class="n">AsyncRateSemaphore</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">greedy_entry</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">greedy_exit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">tick_req</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">agetTick</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>    <span class="n">ohlcv_req</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">agetOHLCV</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="n">transactions</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        <span class="n">sem</span><span class="o">.</span><span class="n">transact</span><span class="p">(</span><span class="n">coroutine</span><span class="o">=</span><span class="n">tick_req</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">credits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">refund_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transaction_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        <span class="n">sem</span><span class="o">.</span><span class="n">transact</span><span class="p">(</span><span class="n">coroutine</span><span class="o">=</span><span class="n">ohlcv_req</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">credits</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">refund_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transaction_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>        <span class="n">sem</span><span class="o">.</span><span class="n">transact</span><span class="p">(</span><span class="n">coroutine</span><span class="o">=</span><span class="n">ohlcv_req</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">credits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">refund_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transaction_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>        <span class="n">sem</span><span class="o">.</span><span class="n">transact</span><span class="p">(</span><span class="n">coroutine</span><span class="o">=</span><span class="n">tick_req</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">credits</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">refund_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">transaction_id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="p">]</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">transactions</span><span class="p">)</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>    <span class="n">sync_example</span><span class="p">()</span> <span class="c1">#previous example</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">async_example</span><span class="p">())</span>
</code></pre></div>
We set the verbosity flag to give us information on when the semaphore executed the transactions, so let us observe the printed information log:
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>-----------------------async with transactions-----------------------
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>2024-03-28 19:17:12.120864:: TXN 1 acquiring CreditSemaphore
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="hll">2024-03-28 19:17:12.120915:: TXN 1 entered CreditSemaphore...
</span><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>2024-03-28 19:17:12.120927:: getTick processing 1 takes 4 seconds
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>2024-03-28 19:17:12.120964:: TXN 2 acquiring CreditSemaphore
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>2024-03-28 19:17:12.120988:: TXN 3 acquiring CreditSemaphore
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="hll">2024-03-28 19:17:12.121006:: TXN 3 entered CreditSemaphore...
</span><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>2024-03-28 19:17:12.121016:: getOHLCV processing 3 takes 5 seconds
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>2024-03-28 19:17:12.121044:: TXN 4 acquiring CreditSemaphore
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>2024-03-28 19:17:16.121665:: getTick processed 1
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="hll">2024-03-28 19:17:16.121740:: TXN 1 exits CreditSemaphore, schedule refund in 10...
</span><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>2024-03-28 19:17:17.122353:: getOHLCV processed 3
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>2024-03-28 19:17:17.122462:: TXN 3 exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="hll">2024-03-28 19:17:26.123119:: TXN 2 entered CreditSemaphore...
</span><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>2024-03-28 19:17:26.123192:: getOHLCV processing 2 takes 1 seconds
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>2024-03-28 19:17:27.123519:: getOHLCV processed 2
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>2024-03-28 19:17:27.123633:: TXN 2 exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>2024-03-28 19:17:37.124999:: TXN 4 entered CreditSemaphore...
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>2024-03-28 19:17:37.125077:: getTick processing 4 takes 3 seconds
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>2024-03-28 19:17:40.126377:: getTick processed 4
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>2024-03-28 19:17:40.126493:: TXN 4 exits CreditSemaphore, schedule refund in 10...
</code></pre></div>
It is not difficult to reason with the output. For instance, transactions 1 and 3 entered the semaphore first, while 2, 4 was placed on hold,
leaving 40 - 20 - 5 = 15 credits. No other transaction can enter the semaphore. Transaction 1 processes and completes at 16 seconds, 
but the credit is only refunded 10 seconds later. We can see that at 26 seconds, the (20) credits from transaction 1 is refunded, giving us
15 + 20 = 35 credits, enough for transaction 2 to enter the semaphore but not both 2 and 4. 2 is admitted first, and the rest of printed log statements are easy to rationalize.</p>
<h4 id="easy-with-decorators_1">Easy with Decorators</h4>
<p>The <a href="#asynchronous-example">example</a> given is nice but somewhat unwiedly due to having to wrap the method/function of interest in semaphore transactions. We would like to hide 
the throttling intricacies at the caller level, such that a user of said data-access layer 
or SDKs do not need to be aware of the presence of a semaphore. For instance:
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">_Throttler</span><span class="p">():</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>        <span class="c1">#... previous example</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">arate_semaphore</span><span class="o">=</span><span class="n">AsyncRateSemaphore</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span>
</span><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="c1">#... previous example</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="nd">@aconsume_credits</span><span class="p">(</span><span class="n">costs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">refund_in</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">attrname</span><span class="o">=</span><span class="s2">&quot;arate_semaphore&quot;</span><span class="p">)</span> <span class="c1">#we want the asynchronous semaphore, and since the default name is not rate_semaphore, we pass in attrname</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_agetTick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getTick processing </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> takes </span><span class="si">{</span><span class="n">work</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getTick processed </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>    <span class="nd">@aconsume_credits</span><span class="p">(</span><span class="n">costs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">refund_in</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">attrname</span><span class="o">=</span><span class="s2">&quot;arate_semaphore&quot;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_agetOHLCV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getOHLCV processing </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> takes </span><span class="si">{</span><span class="n">work</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">work</span><span class="p">)</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="si">}</span><span class="s2">:: getOHLCV processed </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
The data-access object is given one or more <a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.AsyncRateSemaphore"><code>AsyncRateSemaphore</code></a> objects corresponding to a unique credit/resource pool. For each 
method that makes a resource-consuming request, we can decorate the function using <a href="../decorators/#quantpylib.throttler.decorators.aconsume_credits"><code>aconsume_credits</code></a> with the costs and refund timers as parameters.
The decorated function calls then are submitted through the object attribute's asynchronous semaphore instance.
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">async_example</span><span class="p">():</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------async with transactions-----------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="c1">#... previous example</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------async with decorator-----------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="n">throttler</span> <span class="o">=</span> <span class="n">_Throttler</span><span class="p">()</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="n">transactions</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>        <span class="n">throttler</span><span class="o">.</span><span class="n">_agetTick</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>        <span class="n">throttler</span><span class="o">.</span><span class="n">_agetOHLCV</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>        <span class="n">throttler</span><span class="o">.</span><span class="n">_agetTick</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>        <span class="n">throttler</span><span class="o">.</span><span class="n">_agetOHLCV</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>    <span class="p">]</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">transactions</span><span class="p">)</span>
</code></pre></div>
The behavior of the semaphore is similar to the example explored in the previous <a href="#asynchronous-example">example</a>. 
The printed log statements are hence presented without commentary, but may be rationalized easily.
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>-----------------------async with decorator-----------------------
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>2024-03-28 19:17:40.126936:: TXN {&#39;fn&#39;: &#39;_agetTick&#39;, &#39;args&#39;: (3, 1), &#39;kwargs&#39;: {}} acquiring CreditSemaphore
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>2024-03-28 19:17:40.127015:: TXN {&#39;fn&#39;: &#39;_agetTick&#39;, &#39;args&#39;: (3, 1), &#39;kwargs&#39;: {}} entered CreditSemaphore...
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>2024-03-28 19:17:40.127044:: getTick processing 1 takes 3 seconds
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>2024-03-28 19:17:40.127110:: TXN {&#39;fn&#39;: &#39;_agetOHLCV&#39;, &#39;args&#39;: (1, 2), &#39;kwargs&#39;: {}} acquiring CreditSemaphore
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>2024-03-28 19:17:40.127149:: TXN {&#39;fn&#39;: &#39;_agetOHLCV&#39;, &#39;args&#39;: (1, 2), &#39;kwargs&#39;: {}} entered CreditSemaphore...
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>2024-03-28 19:17:40.127170:: getOHLCV processing 2 takes 1 seconds
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>2024-03-28 19:17:40.127217:: TXN {&#39;fn&#39;: &#39;_agetTick&#39;, &#39;args&#39;: (3, 3), &#39;kwargs&#39;: {}} acquiring CreditSemaphore
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>2024-03-28 19:17:40.127266:: TXN {&#39;fn&#39;: &#39;_agetOHLCV&#39;, &#39;args&#39;: (1, 4), &#39;kwargs&#39;: {}} acquiring CreditSemaphore
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>2024-03-28 19:17:41.127912:: getOHLCV processed 2
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>2024-03-28 19:17:41.128021:: TXN {&#39;fn&#39;: &#39;_agetOHLCV&#39;, &#39;args&#39;: (1, 2), &#39;kwargs&#39;: {}} exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>2024-03-28 19:17:43.127485:: getTick processed 1
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>2024-03-28 19:17:43.127539:: TXN {&#39;fn&#39;: &#39;_agetTick&#39;, &#39;args&#39;: (3, 1), &#39;kwargs&#39;: {}} exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>2024-03-28 19:17:51.129270:: TXN {&#39;fn&#39;: &#39;_agetOHLCV&#39;, &#39;args&#39;: (1, 4), &#39;kwargs&#39;: {}} entered CreditSemaphore...
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>2024-03-28 19:17:51.129314:: getOHLCV processing 4 takes 1 seconds
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>2024-03-28 19:17:52.130482:: getOHLCV processed 4
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>2024-03-28 19:17:52.130534:: TXN {&#39;fn&#39;: &#39;_agetOHLCV&#39;, &#39;args&#39;: (1, 4), &#39;kwargs&#39;: {}} exits CreditSemaphore, schedule refund in 10...
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>2024-03-28 19:17:53.128193:: TXN {&#39;fn&#39;: &#39;_agetTick&#39;, &#39;args&#39;: (3, 3), &#39;kwargs&#39;: {}} entered CreditSemaphore...
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>2024-03-28 19:17:53.128281:: getTick processing 3 takes 3 seconds
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>2024-03-28 19:17:56.129573:: getTick processed 3
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>2024-03-28 19:17:56.129683:: TXN {&#39;fn&#39;: &#39;_agetTick&#39;, &#39;args&#39;: (3, 3), &#39;kwargs&#39;: {}} exits CreditSemaphore, schedule refund in 10...
</code></pre></div></p>
<h3 id="notes-on-behavior">Notes on Behavior</h3>
<ul>
<li>
<p><h4> Entry Behavior </h4>  </p>
<ol>
<li><a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.AsyncRateSemaphore"><code>AsyncRateSemaphore</code></a> acquires the semaphore if there are enough resources, but if <code>greedy_entry=False</code>, then the submitted transaction will wait behind the earlier pending transactions regardless of the resource pool availability. Otherwise, any submitted transaction that can run immediately will run without consideration for existing waiters.</li>
<li><a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.RateSemaphore"><code>RateSemaphore</code></a>
acquires the semaphore immediately if there are enough resources, and 
otherwise waits. The order in which blocked threads are awakened should not be relied on and is OS-scheduler dependent.</li>
</ol>
</li>
<li>
<p><h4> Exit Behavior </h4> 
Requests submitted to both semaphore types exit from their respective <code>transact</code> method
without waiting for the credits to be refunded. The credits are scheduled to be refunded separately on a thread (for synchronous implementations) or the event loop (for asynchronous implementations). When the credit is refunded </p>
<ol>
<li>
<p><a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.AsyncRateSemaphore"><code>AsyncRateSemaphore</code></a> wakes up pending transactions that are able to execute on the state of the resource pool. If <code>greedy_exit=False</code>, then the number of pending transactions woken up will respect the FIFO order until the resource pool is insufficient for the earliest transaction. Otherwise, when credits are refunded with &gt;=2 waiting transactions with arrival time <code>txn A</code> &lt; <code>txn B</code>. If the semaphore has not enough credits to execute <code>txn A</code>, it can first run <code>txn B</code>. This helps to maximise throughput.</p>
</li>
<li>
<p><a href="../rate_semaphore/#quantpylib.throttler.rate_semaphore.RateSemaphore"><code>RateSemaphore</code></a>
wakes up pending transactions that are able to execute on the state of the resource pool.
The order in which blocked threads are awakened should not be relied on and is OS-scheduler dependent.</p>
</li>
</ol>
</li>
<li>
<p><h4> Exception Behavior </h4> 
Failed transactions (raised Exceptions) consume and refund credit in the same way as successful transactions.</p>
</li>
</ul>
<summary>
Note that non-greedy entry and greedy exit can cause resource-expensive transactions to sit behind cheaper transactions which are constantly being submitted to the semaphore at a fast rate, preventing the expensive transaction from acquiring the semaphore.
</summary>

<h3 id="best-practices">Best Practices</h3>
<ul>
<li>
<p>Wrap unstable networks and expensive requests in a timeout transaction. This is to prevent the coroutine from 'await'-ing forever and hogging the semaphore.</p>
</li>
<li>
<p>Since the transactions wrap native Python functions and coroutines,
it does not know when the code actually performs the credit-costing request. The <code>transact</code> functions should be closest to the costful logic as possible. It should not perform heavy compute or multiple requests so that the credits can refunded as quickly as possible for other transactions. </p>
</li>
</ul>
<h2 id="throttlerratesemaphore"><a href="../rate_semaphore/">throttler.rate_semaphore</a></h1>
<h2 id="throttlerratedecorator"><a href="../decorators/">throttler.decorators</a></h1>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 <a href="https://hangukquant.com"  target="_blank" rel="noopener">Quanta Global Pte. Ltd. 202328387H - All Rights Reserved.</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/hangukquant" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>